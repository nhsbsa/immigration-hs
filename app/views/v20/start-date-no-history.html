{% extends "layout-health.html" %}

{% block pageTitle %}
Start date of new claim â€“ Immigration Health Surcharge Refund Service
{% endblock %}

{% block beforeContent %}
<div class="govuk-phase-banner">
  <p class="govuk-phase-banner__content">
    <span class="govuk-phase-banner__text">
      Your <a class="govuk-link" href="https://wh1.snapsurveys.com/SURVEY_PREVIEW.asp?k=162645215363" target="_blank"
        rel="noopener noreferrer">feedback (opens in new tab)</a> will help us to improve this service.
    </span>
  </p>
</div>
<a class="govuk-back-link" href="/v20/dependant-question">Back</a>
{% endblock %}

{% block content %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">

    <h1 class="govuk-heading-l">
      <span class="govuk-caption-l">Application</span>
      What is the start date of this claim
    </h1>


 

    <p class="govuk-body">This is the date the applicant started working in an eligible job, <strong>not</strong> the date the
      applicant's visa started.
    </p>
    <p class="govuk-body">We'll work out the end date of this claim from the start date you enter. The end date will be
      6 months after the start date because you can only claim reimbursement for 6 months at a time.
    </p>

    <p>The earliest date you can claim an IHS reimbursement from is 31 March 2020.</p>

    <!-- <details class="govuk-details">
          <summary class="govuk-details__summary">
            <span class="govuk-details__summary-text">
              If you want to make a claim for an earlier time </span>
          </summary>
          <div class="govuk-details__text">
            The earliest date you can claim an IHS reimbursement from is 31 March 2020.
          </div>
        </details> -->
    <div id="passport-issued-hint" class="govuk-hint">For example, 15 8 2020</div>

    <div class="govuk-date-input" id="passport-issued">
      <div class="govuk-date-input__item">
        <div class="govuk-form-group">
          <label class="govuk-label govuk-date-input__label" for="day">Day</label>
          <input class="govuk-input govuk-date-input__input govuk-input--width-2" id="day" name="day" type="text">
        </div>
      </div>
      <div class="govuk-date-input__item">
        <div class="govuk-form-group">
          <label class="govuk-label govuk-date-input__label" for="month">Month</label>
          <input class="govuk-input govuk-date-input__input govuk-input--width-2" id="month" name="month" type="text">
        </div>
      </div>
      <div class="govuk-date-input__item">
        <div class="govuk-form-group">
          <label class="govuk-label govuk-date-input__label" for="year">Year</label>
          <input class="govuk-input govuk-date-input__input govuk-input--width-4" id="year" name="year" type="text">
        </div>
      </div>
    </div>
  </div>
  </div>

  <button type="submit" class="govuk-button" data-module="govuk-button">Continue</button>
  </form>
</div>
</div>

<script>
  document.getElementById('start-date-form').addEventListener('submit', function (e) {
    e.preventDefault();

    const day = parseInt(document.getElementById('day').value, 10);
    const month = parseInt(document.getElementById('month').value, 10) - 1;
    const year = parseInt(document.getElementById('year').value, 10);
    const enteredDate = new Date(year, month, day);

    if (isNaN(enteredDate)) {
      alert("Please enter a valid date");
      return;
    }

    // Store date parts
    localStorage.setItem("claimDay", day);
    localStorage.setItem("claimMonth", month + 1);
    localStorage.setItem("claimYear", year);

    // Store formatted date
    const formattedDate = enteredDate.toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' });
    localStorage.setItem('enteredDate', formattedDate);

    // Check claim table for overlap / identical
    let warningType = null;
    document.querySelectorAll('#claims-table tbody tr').forEach(row => {
      const start = new Date(row.cells[2].textContent.trim());
      const end = new Date(row.cells[3].textContent.trim());

      if (enteredDate.getTime() === start.getTime()) {
        warningType = 'identical'; // priority
      } else if (!warningType && enteredDate >= start && enteredDate <= end) {
        warningType = 'overlap';
      }
    });

    localStorage.setItem('warningType', warningType || 'none');
    window.location.href = 'start-date-cya-warning';
  });
</script>
{% endblock %}