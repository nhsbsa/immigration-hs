{% extends "layouts/layout-health.html" %}

{% block pageTitle %}
Check you have all the evidence you need
{% endblock %}

{% block content %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">

    <h1 class="govuk-heading-l">
      <span class="govuk-caption-l">Dependant application</span>
      Evidence you need to prove the dependant's eligibility
    </h1>

    <p>
      Based on the dependant's claim period start date, we need to see evidence showing that the main applicant worked in a health and social care role from <strong>1 July 2022</strong>
      to <strong>9 September 2022</strong>.
    </p>

    <h2 class="govuk-heading-m">Payslips</h2>



    <p>You'll need to send payslips that cover:</p>
    <ul class="govuk-list govuk-list--bullet" id="payslip-dates">
      <li>1 July 2022 to 31 July 2022</li>
      <lI>1 August 2022 to 31 August 2022</lI>
      <li>1 September 2022 to 30 September 2022</li>
      <li>1 October 2022 to 9 October 2022</li>
    </ul>

    <!-- Inset text shown if end date is in the future -->
    <div id="current-month-warning" class="govuk-inset-text" hidden>
      If the applicant has not been paid for <span id="current-month-year"></span> yet,
      you should wait to apply until they have a payslip for <span id="current-month-year-2"></span>.
    </div>





    <form class="form" action="/task-list-dependant-2" method="post">
      <fieldset class="govuk-fieldset">
        <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
          <h1 class="govuk-fieldset__heading">
            Do you have all the evidence in the list?</h1>
        </legend>
        <div class="govuk-radios govuk-radios--inline">
          <div class="govuk-radios__item">
            <input class="govuk-radios__input" id="average-time-conditional" name="average-time-v20" type="radio"
              value="yes">
            <label class="govuk-label govuk-radios__label" for="average-time-conditional">Yes</label>
          </div>

          <div class="govuk-radios__item">
            <input class="govuk-radios__input" id="average-time-conditional-2" name="average-time-v20" type="radio"
              value="no">
            <label class="govuk-label govuk-radios__label" for="average-time-conditional-2">No</label>
          </div>
        </div>
      </fieldset>
      <br>
      <button type="submit" class="govuk-button">Continue</button>
    </form>
  </div>
</div>

<!-- <script>
document.addEventListener("DOMContentLoaded", function () {

  // Pull from localStorage (set on Page 1 + 2)
  const day = parseInt(localStorage.getItem("claimDay"), 10);
  const month = parseInt(localStorage.getItem("claimMonth"), 10);
  const year = parseInt(localStorage.getItem("claimYear"), 10);

  if (!day || !month || !year) return; // No date saved yet

  const startDate = new Date(year, month - 1, day);

  // Correct end date calculation
  function addMonthsSafe(date, months) {
    const d = new Date(date);
    const targetMonth = d.getMonth() + months;
    d.setMonth(targetMonth);
    // Handle month overflow for short months
    while (d.getMonth() !== ((targetMonth) % 12 + 12) % 12) {
      d.setDate(d.getDate() - 1);
    }
    return d;
  }

  let endDate = addMonthsSafe(startDate, 6);
  endDate.setDate(endDate.getDate() - 1);

  const options = { day: "numeric", month: "long", year: "numeric" };
  document.getElementById("start-date").textContent = startDate.toLocaleDateString("en-GB", options);
  document.getElementById("end-date").textContent = endDate.toLocaleDateString("en-GB", options);

  const payslipList = document.getElementById("payslip-dates");
  payslipList.innerHTML = "";

  let current = new Date(startDate);
  let bulletCount = 0;

  while (current <= endDate) {
    const monthStart = new Date(current.getFullYear(), current.getMonth(), 1);
    const monthEnd = new Date(current.getFullYear(), current.getMonth() + 1, 0);
    const periodStart = (monthStart < startDate) ? startDate : monthStart;
    const periodEnd = (monthEnd > endDate) ? endDate : monthEnd;

    const listItem = document.createElement("li");

    if (periodStart.getTime() === periodEnd.getTime()) {
      listItem.textContent = periodStart.toLocaleDateString("en-GB", options);
    } else {
      listItem.textContent = `${periodStart.toLocaleDateString("en-GB", options)} to ${periodEnd.toLocaleDateString("en-GB", options)}`;
    }

    payslipList.appendChild(listItem);
    bulletCount++;

    current = new Date(periodEnd.getFullYear(), periodEnd.getMonth() + 1, 1);
  }

  if (bulletCount === 7) {
    document.getElementById("seven-month-info").hidden = false;
  }

  const today = new Date();
  if (endDate > today) {
    const monthYearString = endDate.toLocaleString("en-GB", { month: "long", year: "numeric" });
    document.getElementById("current-month-year").textContent = monthYearString;
    document.getElementById("current-month-year-2").textContent = monthYearString;
    document.getElementById("current-month-warning").hidden = false;
  }

});
</script> -->

{% endblock %}