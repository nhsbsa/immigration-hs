{% extends "layout-health.html" %}

{% block pageTitle %}
IHS question
{% endblock %}

{% block beforeContent %}
<div class="govuk-phase-banner">
  <p class="govuk-phase-banner__content">
    <span class="govuk-phase-banner__text">
      Your <a class="govuk-link" href="https://wh1.snapsurveys.com/SURVEY_PREVIEW.asp?k=162645215363">feedback (opens in
        new tab)</a> will help us to improve this service.
    </span>
  </p>
</div>
<a class="govuk-back-link" href="javascript:window.history.back()">Back</a>
{% endblock %}

{% block content %}
<div id="content"></div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <form class="form" action="/check-start-date" method="post">
      <div class="govuk-form-group">

        <!-- Notification banner (will be removed if not needed) -->
        <div id="overlap-banner" class="govuk-notification-banner" aria-labelledby="notification-banner-title" data-module="govuk-notification-banner">
          <div class="govuk-notification-banner__header">
            <h2 class="govuk-notification-banner__title" id="notification-banner-title">
              Important
            </h2>
          </div>
          <div class="govuk-notification-banner__content">
            <p class="govuk-notification-banner__heading">
              This start date overlaps with a previous claim period. If you continue with this claim, you might be rejected.
            </p>
          </div>
        </div>

        <span class="govuk-caption-l">Application</span>
        <fieldset class="govuk-fieldset" aria-describedby="doug-ihs-question-conditional-hint-v8">
          <legend class="govuk-fieldset__legend govuk-fieldset__legend--l visuallyhidden">
            <h1 class="govuk-fieldset__heading">Check the start date</h1>
          </legend>

          <div class="govuk-form-group">
            <div class="govuk-warning-text">
              <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
              <strong class="govuk-warning-text__text">
                <span class="govuk-visually-hidden">Warning</span>
                You will not be able to change this date again.
              </strong>
            </div>

            <dl class="govuk-summary-list">
              <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">Claim start date</dt>
                <dd class="govuk-summary-list__value">
                  <span id="summary-date">20 April 2020</span>
                </dd>
                <dd class="govuk-summary-list__actions">
                  <ul class="govuk-summary-list__actions-list">
                    <li class="govuk-summary-list__actions-list-item">
                      <a class="govuk-link" href="/v20/start-date-claim-dates-warning">Change
                        <span class="govuk-visually-hidden"> contact details</span>
                      </a>
                    </li>
                  </ul>
                </dd>
              </div>
            </dl>

            <div class="govuk-form-group">
              <div class="govuk-checkboxes" data-module="govuk-checkboxes">
                <div class="govuk-checkboxes__item">
                  <input class="govuk-checkboxes__input" id="confirm-start-date" name="confirm-start-date" type="checkbox" value="yes">
                  <label class="govuk-label govuk-checkboxes__label" for="confirm-start-date">
                    I confirm this start date is correct.
                  </label>
                </div>
              </div>
            </div>

            <!--
            Keep any additional fields you had here (commented out in your example)
            -->
          </div>
        </fieldset>
      </div>

      <a href="monthly" class="govuk-button" data-module="govuk-button">Continue</a>
    </form>
  </div>
</div>

<script>
  (function () {
    // Prefer localStorage (from page 1 solution); fall back to sessionStorage if needed.
    const get = (k) => localStorage.getItem(k) ?? sessionStorage.getItem(k);

    // 1) Decide whether to show the warning
    const showWarningFlag = (get('showWarning') === 'true');
    if (!showWarningFlag) {
      const banner = document.getElementById('overlap-banner');
      if (banner && banner.parentNode) {
        banner.parentNode.removeChild(banner);
      }
    }

    // 2) Populate the summary date in "1 January 2020" format
    const summaryEl = document.getElementById('summary-date');
    let pretty = get('enteredDate'); // already formatted like "1 January 2020" by page 1

    // If not present, try ISO value and format it here.
    if (!pretty) {
      const iso = get('startDate'); // if you ever stored an ISO string instead
      if (iso) {
        const d = new Date(iso);
        if (!isNaN(d.getTime())) {
          pretty = d.toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' });
        }
      }
    }

    if (summaryEl && pretty) {
      summaryEl.textContent = pretty;
    }
  })();
</script>
{% endblock %}
